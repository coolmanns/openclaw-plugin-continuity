{
  "id": "continuity",
  "name": "Infinite Thread — Agent Continuity & Memory",
  "description": "Persistent, intelligent memory for OpenClaw agents. Context budgeting, continuity anchors, topic tracking, conversation archiving, and cross-session semantic search via SQLite-vec. Gives an agent the ability to remember, not just retrieve.",
  "version": "0.1.0",
  "configSchema": {
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "contextBudget": {
        "type": "object",
        "description": "Token budget allocation and priority tier configuration",
        "properties": {
          "contextBudgetRatio": { "type": "number", "default": 0.65, "description": "Fraction of maxTokens reserved for context (remainder is for system prompt + response)" },
          "recentTurnsAlwaysFull": { "type": "number", "default": 5, "description": "Last N turns are never truncated" },
          "recentTurnCharLimit": { "type": "number", "default": 3000, "description": "Max characters for recent turns" },
          "midTurnCharLimit": { "type": "number", "default": 1500, "description": "Max characters for mid-age turns" },
          "olderTurnCharLimit": { "type": "number", "default": 500, "description": "Max characters for older turns" },
          "poolRatios": {
            "type": "object",
            "description": "Budget distribution across priority tiers (must sum to 1.0)",
            "properties": {
              "essential": { "type": "number", "default": 0.30 },
              "high": { "type": "number", "default": 0.25 },
              "medium": { "type": "number", "default": 0.25 },
              "low": { "type": "number", "default": 0.15 },
              "minimal": { "type": "number", "default": 0.05 }
            }
          }
        }
      },
      "anchors": {
        "type": "object",
        "description": "Continuity anchor detection — preserves identity moments, contradictions, and tensions",
        "properties": {
          "enabled": { "type": "boolean", "default": true },
          "maxAge": { "type": "number", "default": 7200000, "description": "Max age in ms before anchors expire (default 2h)" },
          "maxCount": { "type": "number", "default": 15, "description": "Max anchors retained" },
          "keywords": {
            "type": "object",
            "description": "Keyword lists for anchor type detection. Fully configurable per domain.",
            "properties": {
              "identity": { "type": "array", "items": { "type": "string" } },
              "contradiction": { "type": "array", "items": { "type": "string" } },
              "tension": { "type": "array", "items": { "type": "string" } }
            }
          }
        }
      },
      "topicTracking": {
        "type": "object",
        "description": "Topic freshness scoring and fixation detection",
        "properties": {
          "enabled": { "type": "boolean", "default": true },
          "windowSize": { "type": "number", "default": 6, "description": "Number of exchanges in the tracking window" },
          "fixationThreshold": { "type": "number", "default": 3, "description": "Mentions before a topic is flagged as fixated" },
          "decayFactor": { "type": "number", "default": 0.5, "description": "Freshness decay multiplier" },
          "customPatterns": { "type": "array", "items": { "type": "string" }, "description": "Custom regex patterns for topic extraction" },
          "minWordLength": { "type": "number", "default": 5, "description": "Minimum word length for frequency-based topic extraction" }
        }
      },
      "compaction": {
        "type": "object",
        "description": "Context compaction triggers and strategies",
        "properties": {
          "threshold": { "type": "number", "default": 0.80, "description": "Token usage ratio that triggers compaction" },
          "fallbackMessages": { "type": "number", "default": 20, "description": "Messages to keep in fallback mode" },
          "taskAwareCompaction": { "type": "boolean", "default": true, "description": "Use task-aware strategy when task context exists" }
        }
      },
      "tokenEstimation": {
        "type": "object",
        "description": "Token counting heuristics (overridden by custom tokenizer if provided)",
        "properties": {
          "tokensPerWord": { "type": "number", "default": 1.3 },
          "specialCharTokenWeight": { "type": "number", "default": 0.5 },
          "defaultMaxTokens": { "type": "number", "default": 8192, "description": "Per-prompt token ceiling (user-adjustable)" }
        }
      },
      "archive": {
        "type": "object",
        "description": "Conversation archive storage",
        "properties": {
          "retentionDays": { "type": "number", "default": 90, "description": "Days to retain archived conversations" },
          "batchIndexDelay": { "type": "number", "default": 100, "description": "Delay in ms between batch index operations" }
        }
      },
      "embedding": {
        "type": "object",
        "description": "SQLite-vec embedding configuration",
        "properties": {
          "model": { "type": "string", "default": "Xenova/all-MiniLM-L6-v2" },
          "dimensions": { "type": "number", "default": 384 }
        }
      },
      "session": {
        "type": "object",
        "description": "Session boundary detection",
        "properties": {
          "interruptedGap": { "type": "number", "default": 7200000, "description": "Gap in ms that signals interrupted session (2h)" },
          "newSessionGap": { "type": "number", "default": 21600000, "description": "Gap in ms that signals new session (6h)" }
        }
      },
      "continuitySection": {
        "type": "object",
        "description": "MEMORY.md ## Continuity section configuration",
        "properties": {
          "enabled": { "type": "boolean", "default": true },
          "maxAnchorsShown": { "type": "number", "default": 5 },
          "maxTopicsShown": { "type": "number", "default": 10 }
        }
      }
    }
  }
}
